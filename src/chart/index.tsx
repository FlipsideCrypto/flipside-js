import { h, Component } from "preact";
import Highcharts, { SeriesLineOptions } from "highcharts";
import API from "../api";

const mockData = {
  columns: ["date", "symbol", "fcas", "mavg_value"],
  prefixes: ["", "", "", "$"],
  data: [
    ["2018-11-13T00:00:00.000000", "BTC", 886.0, 886.0],
    ["2018-11-14T00:00:00.000000", "BTC", 887.0, 886.5],
    ["2018-11-15T00:00:00.000000", "BTC", 885.0, 886.0],
    ["2018-11-16T00:00:00.000000", "BTC", 884.0, 885.5],
    ["2018-11-17T00:00:00.000000", "BTC", 884.0, 885.2],
    ["2018-11-18T00:00:00.000000", "BTC", 885.0, 885.1666666666666],
    ["2018-11-19T00:00:00.000000", "BTC", 887.0, 885.4285714285714],
    ["2018-11-20T00:00:00.000000", "BTC", 886.0, 885.5],
    ["2018-11-21T00:00:00.000000", "BTC", 886.0, 885.5555555555555],
    ["2018-11-22T00:00:00.000000", "BTC", 886.0, 885.6],
    ["2018-11-23T00:00:00.000000", "BTC", 885.0, 885.5454545454545],
    ["2018-11-24T00:00:00.000000", "BTC", 884.0, 885.4166666666666],
    ["2018-11-25T00:00:00.000000", "BTC", 882.0, 885.1538461538462],
    ["2018-11-26T00:00:00.000000", "BTC", 883.0, 885.0],
    ["2018-11-27T00:00:00.000000", "BTC", 884.0, 884.9333333333333],
    ["2018-11-28T00:00:00.000000", "BTC", 887.0, 885.0625],
    ["2018-11-29T00:00:00.000000", "BTC", 891.0, 885.4117647058823],
    ["2018-11-30T00:00:00.000000", "BTC", 894.0, 885.8888888888889],
    ["2018-12-01T00:00:00.000000", "BTC", 895.0, 886.3684210526316],
    ["2018-12-02T00:00:00.000000", "BTC", 895.0, 886.8],
    ["2018-12-03T00:00:00.000000", "BTC", 895.0, 887.1904761904761],
    ["2018-12-04T00:00:00.000000", "BTC", 895.0, 887.5454545454545],
    ["2018-12-05T00:00:00.000000", "BTC", 894.0, 887.8260869565217],
    ["2018-12-06T00:00:00.000000", "BTC", 892.0, 888.0],
    ["2018-12-07T00:00:00.000000", "BTC", 891.0, 888.12],
    ["2018-12-08T00:00:00.000000", "BTC", 891.0, 888.2307692307693],
    ["2018-12-09T00:00:00.000000", "BTC", 889.0, 888.2592592592592],
    ["2018-12-10T00:00:00.000000", "BTC", 886.0, 888.1785714285714],
    ["2018-12-11T00:00:00.000000", "BTC", 884.0, 888.0344827586207],
    ["2018-12-12T00:00:00.000000", "BTC", 885.0, 887.9333333333333],
    ["2018-12-13T00:00:00.000000", "BTC", 885.0, 887.8387096774194],
    ["2018-12-14T00:00:00.000000", "BTC", 886.0, 887.78125],
    ["2018-12-15T00:00:00.000000", "BTC", 886.0, 887.7272727272727],
    ["2018-12-16T00:00:00.000000", "BTC", 885.0, 887.6470588235294],
    ["2018-12-17T00:00:00.000000", "BTC", 887.0, 887.6285714285714],
    ["2018-12-18T00:00:00.000000", "BTC", 886.0, 887.5833333333334],
    ["2018-12-19T00:00:00.000000", "BTC", 884.0, 887.4864864864865],
    ["2018-12-20T00:00:00.000000", "BTC", 883.0, 887.3684210526316],
    ["2018-12-21T00:00:00.000000", "BTC", 884.0, 887.2820512820513],
    ["2018-12-22T00:00:00.000000", "BTC", 884.0, 887.2],
    ["2018-12-23T00:00:00.000000", "BTC", 883.0, 887.0975609756098],
    ["2018-12-24T00:00:00.000000", "BTC", 882.0, 886.9761904761905],
    ["2018-12-25T00:00:00.000000", "BTC", 882.0, 886.8604651162791],
    ["2018-12-26T00:00:00.000000", "BTC", 884.0, 886.7954545454545],
    ["2018-12-27T00:00:00.000000", "BTC", 884.0, 886.7333333333333],
    ["2018-12-28T00:00:00.000000", "BTC", 882.0, 886.6304347826087],
    ["2018-12-29T00:00:00.000000", "BTC", 880.0, 886.4893617021277],
    ["2018-12-30T00:00:00.000000", "BTC", 881.0, 886.375],
    ["2018-12-31T00:00:00.000000", "BTC", 881.0, 886.265306122449],
    ["2019-01-01T00:00:00.000000", "BTC", 882.0, 886.18],
    ["2019-01-02T00:00:00.000000", "BTC", 884.0, 886.1372549019608],
    ["2019-01-03T00:00:00.000000", "BTC", 887.0, 886.1538461538462],
    ["2019-01-04T00:00:00.000000", "BTC", 890.0, 886.2264150943396],
    ["2019-01-05T00:00:00.000000", "BTC", 892.0, 886.3333333333334],
    ["2019-01-06T00:00:00.000000", "BTC", 892.0, 886.4363636363636],
    ["2019-01-07T00:00:00.000000", "BTC", 893.0, 886.5535714285714],
    ["2019-01-08T00:00:00.000000", "BTC", 895.0, 886.7017543859649],
    ["2019-01-09T00:00:00.000000", "BTC", 896.0, 886.8620689655172],
    ["2019-01-10T00:00:00.000000", "BTC", 895.0, 887.0],
    ["2019-01-11T00:00:00.000000", "BTC", 895.0, 887.1333333333333],
    ["2019-01-12T00:00:00.000000", "BTC", 894.0, 887.2459016393443],
    ["2019-01-13T00:00:00.000000", "BTC", 891.0, 887.3064516129032],
    ["2019-01-14T00:00:00.000000", "BTC", 889.0, 887.3333333333334],
    ["2019-01-15T00:00:00.000000", "BTC", 888.0, 887.34375],
    ["2019-01-16T00:00:00.000000", "BTC", 888.0, 887.3538461538461],
    ["2019-01-17T00:00:00.000000", "BTC", 889.0, 887.3787878787879],
    ["2019-01-18T00:00:00.000000", "BTC", 889.0, 887.4029850746268],
    ["2019-01-19T00:00:00.000000", "BTC", 890.0, 887.4411764705883],
    ["2019-01-20T00:00:00.000000", "BTC", 888.0, 887.4492753623189],
    ["2019-01-21T00:00:00.000000", "BTC", 885.0, 887.4142857142857],
    ["2019-01-22T00:00:00.000000", "BTC", 885.0, 887.3802816901408],
    ["2019-01-23T00:00:00.000000", "BTC", 884.0, 887.3333333333334],
    ["2019-01-24T00:00:00.000000", "BTC", 882.0, 887.2602739726027],
    ["2019-01-25T00:00:00.000000", "BTC", 881.0, 887.1756756756756],
    ["2019-01-26T00:00:00.000000", "BTC", 880.0, 887.08],
    ["2019-01-27T00:00:00.000000", "BTC", 880.0, 886.9868421052631],
    ["2019-01-28T00:00:00.000000", "BTC", 881.0, 886.9090909090909],
    ["2019-01-29T00:00:00.000000", "BTC", 883.0, 886.8589743589744],
    ["2019-01-30T00:00:00.000000", "BTC", 883.0, 886.8101265822785],
    ["2019-01-31T00:00:00.000000", "BTC", 883.0, 886.7625],
    ["2019-02-01T00:00:00.000000", "BTC", 881.0, 886.6913580246913],
    ["2019-02-02T00:00:00.000000", "BTC", 879.0, 886.5975609756098],
    ["2019-02-03T00:00:00.000000", "BTC", 879.0, 886.5060240963855],
    ["2019-02-04T00:00:00.000000", "BTC", 876.0, 886.3809523809524],
    ["2019-02-05T00:00:00.000000", "BTC", 874.0, 886.2352941176471],
    ["2019-02-06T00:00:00.000000", "BTC", 874.0, 886.0930232558139],
    ["2019-02-07T00:00:00.000000", "BTC", 875.0, 885.9655172413793],
    ["2019-02-08T00:00:00.000000", "BTC", 878.0, 885.875],
    ["2019-02-09T00:00:00.000000", "BTC", 877.0, 885.7752808988764],
    ["2019-02-10T00:00:00.000000", "BTC", 878.0, 885.6888888888889],
    ["2019-02-11T00:00:00.000000", "BTC", 878.0, 885.6043956043956]
  ]
};

type ChartType = "line" | "bar";
type ChartAxis = "left" | "right";
type ChartSeries = {
  symbol: string;
  metric: string;
  type: ChartType;
  yAxis?: ChartAxis;
};

export type Props = {
  series: ChartSeries[];
  api: API;
};

class Chart extends Component<Props> {
  container: HTMLElement;

  componentDidMount() {
    const zippedData = mockData.data.map(r => {
      return r.reduce(
        (acc, v, i) => {
          acc[mockData.columns[i]] = v;
          return acc;
        },
        {} as any
      );
    });

    const series = this.props.series.map(s => {
      const data = zippedData
        .filter(r => r.symbol === s.symbol.toUpperCase())
        .map(r => [r.date, r[s.metric]]);
      return { name: s.metric, yAxis: s.yAxis, data } as SeriesLineOptions;
    });

    Highcharts.chart({
      legend: {
        enabled: false
      },
      colors: ["#F5A623", "#2D57ED", "#48A748", "#006093", "#5A2788"],
      chart: {
        renderTo: this.container
      },
      title: {
        text: undefined
      },
      tooltip: {
        split: true
      },
      credits: {
        enabled: false
      },
      xAxis: {
        type: "datetime",
        crosshair: true,
        labels: { style: { color: "#9B9B9B" } }
      },
      yAxis: [
        {
          title: { text: undefined },
          labels: { style: { color: "#9B9B9B" } }
        },
        {
          title: { text: undefined },
          labels: { style: { color: "#9B9B9B" } },
          opposite: true
        }
      ],
      series: series
    });
  }

  render() {
    return <div ref={el => (this.container = el)} />;
  }
}

export default Chart;
